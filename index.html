<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì§€ë¢°ì°¾ê¸° ğŸ’£</title>
<style>
  :root {
    --bg: #fffdf8;
    --cell: #fefefe;
    --border: #e0ddd5;
    --mine: #ff9b9b;
    --flag: #ffd36b;
    --text: #333;
    --shadow: 0 3px 10px rgba(0,0,0,0.05);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: "Noto Sans KR", sans-serif;
    background: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    user-select: none;
  }
  h1 { margin-bottom: 5px; text-align: center; }
  .subtitle { color: #777; margin-bottom: 20px; text-align: center; }
  .controls {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    justify-content: center;
  }
  select, button {
    background: #ffd86b;
    border: none;
    border-radius: 8px;
    padding: 10px 14px;
    cursor: pointer;
    box-shadow: var(--shadow);
    font-weight: bold;
    font-size: 15px;
  }
  select:hover, button:hover {
    background: #ffeaa0;
  }

  #board {
    display: grid;
    border: 2px solid var(--border);
    box-shadow: var(--shadow);
    touch-action: manipulation;
  }

  .cell {
    width: min(8vw, 40px);
    height: min(8vw, 40px);
    background: var(--cell);
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    cursor: pointer;
    font-size: clamp(10px, 3vw, 16px);
    transition: background 0.2s;
  }

  .cell.open { background: #e9f7ef; cursor: default; }
  .cell.mine { background: var(--mine); color: white; }
  .cell.flag { background: var(--flag); }

  #status {
    margin-top: 15px;
    font-weight: bold;
    text-align: center;
  }
</style>
</head>
<body>
  <h1>ì§€ë¢°ì°¾ê¸° ğŸ’£</h1>
  <div class="subtitle">ì•„ì´íŒ¨ë“œì—ì„œë„ í„°ì¹˜ë¡œ ì¦ê¸°ëŠ” ì§€ë¢°ì°¾ê¸°!</div>

  <div class="controls">
    <select id="difficulty">
      <option value="easy">ë‚œì´ë„: í•˜</option>
      <option value="medium">ë‚œì´ë„: ì¤‘</option>
      <option value="hard">ë‚œì´ë„: ìƒ</option>
    </select>
    <button id="newGame">ìƒˆ ê²Œì„</button>
  </div>

  <div id="board"></div>
  <div id="status"></div>

<script>
const boardEl = document.getElementById('board');
const statusEl = document.getElementById('status');
const difficultyEl = document.getElementById('difficulty');
let size = 8, mineCount = 10;
let board = [];
let revealed = [];
let gameOver = false;

function setup(difficulty) {
  if (difficulty === 'easy') { size = 8; mineCount = 10; }
  else if (difficulty === 'medium') { size = 12; mineCount = 20; }
  else { size = 16; mineCount = 40; }

  gameOver = false;
  statusEl.textContent = '';

  // ì§€ë¢° ë°°ì¹˜
  board = Array.from({ length: size }, () => Array(size).fill(0));
  revealed = Array.from({ length: size }, () => Array(size).fill(false));
  let minesPlaced = 0;
  while (minesPlaced < mineCount) {
    let x = Math.floor(Math.random() * size);
    let y = Math.floor(Math.random() * size);
    if (board[y][x] !== 'M') {
      board[y][x] = 'M';
      minesPlaced++;
    }
  }

  // ìˆ«ì ì±„ìš°ê¸°
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      if (board[y][x] === 'M') continue;
      let count = 0;
      for (let dy = -1; dy <= 1; dy++) {
        for (let dx = -1; dx <= 1; dx++) {
          const ny = y + dy, nx = x + dx;
          if (ny >= 0 && ny < size && nx >= 0 && nx < size && board[ny][nx] === 'M') count++;
        }
      }
      board[y][x] = count;
    }
  }

  drawBoard();
}

function drawBoard() {
  boardEl.innerHTML = '';
  boardEl.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
  boardEl.style.gridTemplateRows = `repeat(${size}, 1fr)`;

  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.x = x;
      cell.dataset.y = y;
      boardEl.appendChild(cell);
    }
  }
}

function getCell(x, y) {
  return boardEl.children[y * size + x];
}

function openCell(x, y) {
  if (gameOver || revealed[y][x]) return;
  const cell = getCell(x, y);
  revealed[y][x] = true;
  cell.classList.add('open');
  cell.classList.remove('flag');

  if (board[y][x] === 'M') {
    cell.classList.add('mine');
    cell.textContent = 'ğŸ’£';
    gameOver = true;
    showAllMines();
    statusEl.textContent = 'ğŸ’¥ ì§€ë¢°ë¥¼ ë°Ÿì•˜ì–´ìš”!';
    return;
  }

  if (board[y][x] > 0) {
    cell.textContent = board[y][x];
  } else {
    for (let dy = -1; dy <= 1; dy++) {
      for (let dx = -1; dx <= 1; dx++) {
        const ny = y + dy, nx = x + dx;
        if (ny >= 0 && ny < size && nx >= 0 && nx < size) openCell(nx, ny);
      }
    }
  }
  checkWin();
}

function showAllMines() {
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      const cell = getCell(x, y);
      if (board[y][x] === 'M') {
        cell.textContent = 'ğŸ’£';
        cell.classList.add('mine');
      }
    }
  }
}

function checkWin() {
  let unopened = 0;
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      if (!revealed[y][x] && board[y][x] !== 'M') unopened++;
    }
  }
  if (unopened === 0 && !gameOver) {
    statusEl.textContent = 'ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ìŠ¹ë¦¬!';
    gameOver = true;
  }
}

// ğŸ“± í„°ì¹˜ ì»¨íŠ¸ë¡¤ (íƒ­ = ì—´ê¸° / ë‘ ë²ˆ íƒ­ = ê¹ƒë°œ)
let lastTap = 0;
boardEl.addEventListener('touchend', e => {
  const target = e.target.closest('.cell');
  if (!target || gameOver) return;

  const now = Date.now();
  const x = +target.dataset.x, y = +target.dataset.y;

  if (now - lastTap < 300) {
    toggleFlag(target, x, y); // ë”ë¸”íƒ­ = ê¹ƒë°œ
  } else {
    openCell(x, y);
  }
  lastTap = now;
});

// ğŸ–±ï¸ ë§ˆìš°ìŠ¤ë„ ê°€ëŠ¥ (í´ë¦­ = ì—´ê¸°, ìš°í´ë¦­ = ê¹ƒë°œ)
boardEl.addEventListener('click', e => {
  const cell = e.target;
  if (!cell.classList.contains('cell')) return;
  const x = +cell.dataset.x;
  const y = +cell.dataset.y;
  openCell(x, y);
});

boardEl.addEventListener('contextmenu', e => {
  e.preventDefault();
  const cell = e.target;
  if (!cell.classList.contains('cell') || gameOver) return;
  const x = +cell.dataset.x, y = +cell.dataset.y;
  toggleFlag(cell, x, y);
});

function toggleFlag(cell, x, y) {
  if (revealed[y][x]) return;
  if (!cell.classList.contains('flag')) {
    cell.classList.add('flag');
    cell.textContent = 'ğŸš©';
  } else {
    cell.classList.remove('flag');
    cell.textContent = '';
  }
}

document.getElementById('newGame').addEventListener('click', () => {
  setup(difficultyEl.value);
});

setup('easy');
</script>
</body>
</html>
